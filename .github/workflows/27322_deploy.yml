name: Github Actions Deploy Demo z uporabo akcije

on:
  workflow_run:
    workflows: ["CI"]
    types:
      - completed

jobs:
  build_and_push_docker_image:
    runs-on: self-hosted
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      
      - name: Set current time
        id: timestamp
        run: echo "DATE=$(date +'%Y-%m-%d--%M-%S')" >> "$GITHUB_ENV"
      
      - name: Build and Push Docker Image
        run: |
          docker build -t ${{ env.DOCKER_USERNAME }}/${{ env.REPONAME }}:${{ env.DATE }} .
          docker push ${{ env.DOCKER_USERNAME }}/${{ env.REPONAME }}:${{ env.DATE }}
        env:
          DATE: ${{ steps.timestamp.outputs.DATE }}

